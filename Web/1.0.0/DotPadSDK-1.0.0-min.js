class DotPadSample{static SAMPLE1="0002200002200002200002200042f22f24000220000220000220000220000009900009900009900009900009f88f9000099000099000099000099000000440000440000440404e400004f00f40000440000440000440000440000002200002200002200002200002f00f2000022000022020272000022000888998888998888998888998888df88f988889988889988889988889a88c111991111991111991111991111bf11f91111991111991111991111951130004400004400004400004400004f00f40000440000440000440000440000002200002200002200002200002f00f20000a20000220000220000220000009900009900009900009d80809f00f90101b90000990000990000990000004400004400004400004500004f00f4000044000044000044000044000";static SAMPLE2="0000000000000000000000000040f22f04000000000000000000000000000000000000000000000000000000f99f0000000000000000000000000000000000000000000000404e000000f44f00000000000000000000000000000000000000000000000000000000f22f0000000000000020270000000000888cc8888cc8888cc8888cc8888cf99fc8888cc8888cc8888cc8888ca88c1113311113311113311113311113f99f31111331111331111331111351130000000000000000000000000000f44f00000000000000000000000000000000000000000000000000000000f22f00000800000000000000000000000000000000000000000000c80800f99f00101300000000000000000000000000000000000000000000100000f44f0000000000000000000000000000"}class DotPadSDK{constructor(){this.DOTPAD_PREFIX="DotPad",this.DOTPAD_SERVICE="49535343-fe7d-4ae5-8fa9-9fafd205e455",this.DOTPAD_CHARACTERISTIC="49535343-1e4d-4bd9-ba61-23c647249616",this.devicesMap=new Map}async request(){const t={filters:[{namePrefix:this.DOTPAD_PREFIX}],optionalServices:[this.DOTPAD_SERVICE]};return await navigator.bluetooth.requestDevice(t)}async connect(t){if(!t)throw new Error("No Bluetooth device selected");const e=await t.gatt.connect(),a=await t.gatt.getPrimaryService(this.DOTPAD_SERVICE),o=await a.getCharacteristic(this.DOTPAD_CHARACTERISTIC),c=e.device.name;return this.devicesMap.set(c,{service:a,characteristic:o}),console.log(`* dotpad connected => ${e.connected}`),console.log(`* dotpad device name => ${c}`),e.connected}async disconnect(t){return this.devicesMap.has(t)&&this.devicesMap.delete(t),t.gatt.disconnect()}async print(t,e,a){console.log(t);const o=this.devicesMap.get(t.name);if(o&&o.characteristic){let t=[];"graphic"===a?t=DotPadData.getGraphicData(e):"text"===a&&(t=DotPadData.getTextData(e));for(let e of t)await o.characteristic.writeValue(e)}else console.error("Device is not connected or characteristic not found")}async addListenerNotification(t,e){if(!t)throw new Error("No Bluetooth device connected");const a=this.devicesMap.get(t.name);a.characteristic.startNotifications().then((()=>{console.log("> Notifications started"),a.characteristic.addEventListener("characteristicvaluechanged",e)}))}}class DotPadData{static getGraphicData(t){return this._getRequestData(t,!1)}static getTextData(t){return this._getRequestData(t,!0)}static getGraphicResetData(){return this._getRequestData(this._getResetData(300),!0)}static getTextResetData(){return this._getRequestData(this._getResetData(20),!1)}static _getResetData(t){return Array(t).fill("00").join()}static _getRequestData(t,e){const a=DotDataUtil.hexToBytes(t),o=[],c=this._getRequestDataChunkList(a,30);return this._addCommandChunk(o,c,e),o}static _getRequestDataChunkList(t,e){const a=[],o=t.length;for(let c=0;c<o;c+=e){const s=c+e,r=t.slice(c,s>o?o:s);a.push(r)}return a}static _addCommandChunk(t,e,a){let o=1;for(const c of e){const e=[...DotPadProtocol.getSync(),...DotPadProtocol.getLength(c),...DotPadProtocol.getDestId(o++),...DotPadProtocol.getCommandType(),...DotPadProtocol.getDisplayMode(a),...DotPadProtocol.getStartCell(),...DotPadProtocol.getDataBody(c),DotPadProtocol.getCheckSum(DotPadProtocol.getDestId(o-1),DotPadProtocol.getCommandType(),DotPadProtocol.getDisplayMode(a),DotPadProtocol.getStartCell(),DotPadProtocol.getDataBody(c))];t.push(DotDataUtil.hexToBytes(e.join("")))}}}class DotPadProtocol{static getSync(){return["AA","55"]}static getLength(t){return["00",DotDataUtil.decimalToHex(t.length+6)]}static getDestId(t){return[DotDataUtil.decimalToHex(t)]}static getCommandType(){return["02","00"]}static getDisplayMode(t){return t?["80"]:["00"]}static getStartCell(){return["00"]}static getDataBody(t){return DotDataUtil.bytesToHexList(t)}static getCheckSum(t,e,a,o,c){const s=[...t,...e,...a,...o,...c];let r=165;for(const t of s)r^=parseInt(t,16);return DotDataUtil.decimalToHex(r)}}class DotDataUtil{static bytesToHex(t){return Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("")}static bytesToHexList(t){return Array.from(t,(t=>t.toString(16).padStart(2,"0")))}static decimalToHex(t){return t.toString(16).padStart(2,"0")}static hexToBytes(t){if(t.length%2!=0)throw new Error("Odd number of hex digits");const e=t.length/2,a=new Uint8Array(e);for(let o=0;o<e;o++){const e=parseInt(t.substring(2*o,2*o+2),16);if(isNaN(e))throw new Error("Expected hex string");a[o]=e}return a}}export{DotPadSDK,DotPadData,DotPadSample};